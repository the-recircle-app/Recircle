> rest-express@1.0.0 dev
[STORAGE] Using in-memory storage for local development
[STORAGE] Fixed user 1 streak to 1 based on receipt activity
[BLOCKCHAIN] ‚úÖ Using private key for wallet: 0xF1f72b305b7bf7b25e85D356927aF36b88dC84Ee
[BLOCKCHAIN] Real blockchain transactions enabled
6:09:11 AM [openai] OpenAI client initialized successfully
Server initialized with wallet addresses: 
  - REWARD_DISTRIBUTOR_WALLET: 0xF1f72b305b7bf7b25e85D356927aF36b88dC84Ee
  - CREATOR_FUND_WALLET: 0x87c844e3314396ca43e5a6065e418d26a09db02b
  - APP_FUND_WALLET: 0x119761865b79bea9e7924edaa630942322ca09d1

‚úÖ All blockchain configuration variables are set
Initializing memory optimization for development
[MEMORY] Environment configured for runtime:
[MEMORY] NODE_OPTIONS: --expose-gc --max-old-space-size=4096 --max-semi-space-size=128
[MEMORY] UV_THREADPOOL_SIZE: 64
[MEMORY] ‚ö†Ô∏è  Garbage collection not available - memory monitoring disabled
[MEMORY] To enable: restart with NODE_OPTIONS="--expose-gc"
‚ÑπÔ∏è  Pierre VeBetterDAO contract system disabled (using direct B3TR distribution instead)
[SOLO-NODE] üîç Checking solo mode setup: {
  VITE_SOLO_MODE_ENABLED: "'true'",
  SOLO_MODE_ENABLED: "'true'",
  NODE_ENV: "'development'",
  viteEnabled: true,
  soloEnabled: true,
  isDev: true,
  finalSoloEnabled: true
}
[SOLO-NODE] üöÄ Setting up integrated VeChain Solo Node routes
[SOLO-NODE] üîß Initializing Solo Node Genesis State...
[SOLO-NODE] ‚úÖ Genesis block created
[SOLO-NODE]    Block #0: 0x00000000851caf3cfdb6e899cf5958bfb1ac3413d346d43539627e6be7ec1b4a
[SOLO-NODE] üí∞ Pre-funded accounts available:
[SOLO-NODE]    Account 1: 0x7567d83b7b8d80addcb281a71d54fc7b3364ffed
[SOLO-NODE]    Account 2: 0xd3ae78222beadb038203be21ed5ce7c9b1bff602
[SOLO-NODE]    Account 3: 0x733b7269443c70de16bbf9b0615307884bcc5636
[SOLO-NODE] ü™ô B3TR Token deployed at: 0x5ef79995fe8a89e0812330e4378eb2660cede699
[SOLO-NODE]    Each account has 100,000 B3TR tokens for testing
[SOLO-NODE] ‚úÖ Solo Node integrated into Express server
[SOLO-NODE] üåê Available at /solo/* endpoints
[SOLO-NODE] Solo Node enabled for development environment
ReCircle server running on port 5000
Memory optimization enabled: true
Server bound to 0.0.0.0:5000 for external access
[User API] GET /api/users/104 - currentStreak: 0, tokenBalance: 0
[User API] GET /api/users/104 - currentStreak: 0, tokenBalance: 0
6:11:10 AM [receipts] Receipt validation request received. Debug mode: enabled (TESTING: forced enabled)
6:11:10 AM [receipts] Starting receipt validation with AI...
6:11:10 AM [openai] Starting OpenAI receipt analysis with model: gpt-4-turbo...
6:11:10 AM [openai] OpenAI request timeout set to 40s with 3 retries
Receipt approval webhook received from Google Sheet: Receipt ID: TEST_003
Receipt approval webhook received from Google Sheet: Receipt ID: TEST_003
6:11:18 AM [openai] OpenAI response received in 7.722s (654 chars)
6:11:18 AM [receipts] Receipt date validation passed: 2025-08-06 (2025-08-06) is 4 days old (TESTING MODE: 30 day limit)
6:11:18 AM [receipts] Receipt from sustainable store (, category: ride_share) is acceptable
Applied digital payment bonus: +0.3 B3TR for using Apple Pay
6:11:18 AM [receipts] Estimated reward calculation:
            - Base reward: 8.1 B3TR
            - Digital payment bonus: 0.3 B3TR
            - VeChain Visa bonus: 0 B3TR
            - Total payment bonuses: 0.3 B3TR
            - Final estimated reward: 8.4 B3TR
          
6:11:18 AM [receipts] Correcting old date in validation data: 2025-08-06 ‚Üí 2025-08-10
Receipt submission received: {
  userId: 104,
  walletAddress: '104',
  storeId: 1,
  storeName: 'Transportation Service',
  amount: 8.4,
  purchaseDate: '2025-08-10',
  category: 'ride_share',
  imageUrl: null,
  isTestMode: true
}
Is test mode: true
6:11:18 AM [receipts] Receipt date validation passed: 2025-08-10 (2025-08-10) is 0 days old
üß™ TESTING MODE: Skipping duplicate receipt checking in submission phase for B3TR wallet testing
6:11:18 AM [receipts] üéØ THRIFT STORE DETECTION:
          - Store name check: NO (Transportation Service)
          - Thrift flag check: NO
          - Store ID check: YES (ID: 1)
          - Confidence: 0
          - Final decision: IS_THRIFT_STORE
6:11:18 AM [receipts] üß™ TEST MODE CHECK: req.body.isTestMode=true, analysisResult.testMode=undefined, isFromTestMode=true
6:11:18 AM [receipts] üß™ TEST MODE OVERRIDE: Bypassing manual review for test receipt - immediate token rewards enabled
6:11:18 AM [receipts] Manual review decision: NOT NEEDED
6:11:18 AM [receipts] Reasons considered: Low confidence (0)
Receipt data ready for creation: {
  storeId: 1,
  userId: 104,
  amount: 8.4,
  purchaseDate: 2025-08-10T00:00:00.000Z,
  imageUrl: null,
  tokenReward: 8,
  category: 're-use item',
  needsManualReview: false
}
New receipt created: {
  id: 3,
  storeId: 1,
  userId: 104,
  amount: 8.4,
  purchaseDate: 2025-08-10T00:00:00.000Z,
  imageUrl: null,
  category: 're-use item',
  verified: false,
  tokenReward: 8,
  needsManualReview: false,
  hasImage: false,
  createdAt: 2025-08-10T06:11:18.179Z
}
6:11:18 AM [receipts] üîÑ FINAL THRIFT STORE OVERRIDE: Bypassing manual review for Transportation Service
6:11:18 AM [receipts] ‚úÖ Thrift store receipt #3 automatically verified!
Receipt token calculation - raw data: {"receiptAmount":8.4,"tokenRewardProvided":8}
Using provided token reward as base: 8 tokens
Test mode - first receipt, not applying streak multiplier to 8 tokens
Reward after streak logic: 8 tokens (no multiplier)
Payment method bonuses:
          - Payment method: Not specified
          - Card last four: Not applicable
          - Digital payment bonus: 0 B3TR
          - VeChain Visa bonus: 0 B3TR
          - Total payment bonuses: 0 B3TR
          - Final reward with payment bonuses: 8 B3TR
        
[User API] GET /api/users/104 - currentStreak: 1, tokenBalance: 0
[ACHIEVEMENT DEBUG] Starting achievement check for user 104
[ACHIEVEMENT DEBUG] User has 1 receipts
[ACHIEVEMENT DEBUG] Is first receipt: true
Checking 0 transactions for achievement first_receipt
No existing achievement transactions found for first_receipt
[ACHIEVEMENT DEBUG] Already has achievement: false
[ACHIEVEMENT DEBUG] Achievement conditions:
          - User ID: 104
          - Is first receipt? true (receipts count: 1)
          - Already has first_receipt achievement? false
        
[ACHIEVEMENT DEBUG] Force award: true
[ACHIEVEMENT DEBUG] Should award first receipt: true
[ACHIEVEMENT DEBUG] Force awarding first_receipt achievement in test mode
[ACHIEVEMENT DEBUG] Achievement bonus calculated: 10 B3TR
Token reward breakdown:
          - Starting balance: 0 B3TR
          - Base receipt reward: 8 B3TR
          - Final receipt reward: 8 B3TR
          - Achievement bonus (if first receipt): 10 B3TR
          - Total new rewards: 18 B3TR
        
Receipt #3 automatically verified and tokens awarded
First receipt (and not previously awarded)! Adding 10 B3TR achievement bonus as a separate transaction
Achievement first_receipt tracked for user 104 with reward 10 B3TR
Achievement bonus awarded: 10 B3TR for first receipt
TEST MODE - Updating user balance: 0 + 18 = 18
[User API] GET /api/users/104 - currentStreak: 1, tokenBalance: 0
[BLOCKCHAIN] Triggering 70/30 distribution for receipt 3
[BLOCKCHAIN] Receipt needsManualReview: false, shouldAwardTokens: true
[BLOCKCHAIN] FORCED EXECUTION - About to execute blockchain distribution
[BLOCKCHAIN] Starting distribution: 18 B3TR to user 0xAbEf6032B9176C186F6BF984f548bdA53349f70a
[BLOCKCHAIN] LOW CONFIDENCE (0) - Using manual review
[BLOCKCHAIN] üöÄ Triggering 70/30 distribution for receipt #3
[BLOCKCHAIN] Attempting REAL B3TR distribution to VeChain testnet
[BLOCKCHAIN] FORCE TEST - Distribution will execute regardless of confidence
[BLOCKCHAIN] About to import distribution router module...
[BLOCKCHAIN] Module imported successfully
[BLOCKCHAIN] üîç RAW AMOUNT DEBUG:
[BLOCKCHAIN] - totalRewards (raw): 18
[BLOCKCHAIN] - totalRewards type: number
[BLOCKCHAIN] - Expected wei units: 18 √ó 10^18
[BLOCKCHAIN] ‚ùå CRITICAL Distribution error: TypeError: distributeTokens is not a function
    at <anonymous> (/home/runner/workspace/server/routes.ts:3349:48)
[BLOCKCHAIN] Error details: {
  message: 'distributeTokens is not a function',
  stack: 'TypeError: distributeTokens is not a function\n' +
    '    at <anonymous> (/home/runner/workspace/server/routes.ts:3349:48)',
  name: 'TypeError'
}
First receipt ever - setting streak to 1
About to update user 104 streak from 1 to 1
[User API] GET /api/users/104 - currentStreak: 1, tokenBalance: 18
[User API] GET /api/users/104 - currentStreak: 1, tokenBalance: 18
[STORAGE DEBUG] updateUserStreak called for user 104, setting streak to 1
[STORAGE DEBUG] User 104 streak updated to 1
User streak update details:
            - User ID: 104
            - Old streak: 1
            - New streak: 1
            - Updated user object streak: 1
          
[User API] GET /api/users/104 - currentStreak: 1, tokenBalance: 18
Verification - User 104 streak is now: 1
Test mode - Updated user streak to: 1
[WEBHOOK] üìä Logging receipt submission to Google Sheets for Uber - Receipt ID: 3
[WEBHOOK] Google Sheets logging triggered - Event Type: submission
[WEBHOOK] Purchase date transformed: Sun Aug 10 2025 00:00:00 GMT+0000 (Coordinated Universal Time) ‚Üí 2025-08-10
[WEBHOOK] Using sustainability category: re-use item
[WEBHOOK] Validation passed for required fields: storeName, purchaseDate, amount, tokenReward, containsPreOwnedItems, paymentMethod, preOwnedKeywordsFound, sustainabilityCategory
6:11:18 AM [webhooks] Sending webhook to Google Sheets for submission event - Receipt ID: 3
[WEBHOOK PAYLOAD] Store: Uber, Date: 2025-08-10, Amount: 8.4, PreOwned: false, Reward: 8, Category: re-use item
[WEBHOOK PAYLOAD FULL] {"receiptId":3,"receipt_id":3,"storeName":"Uber","store_name":"Uber","storeId":1,"store_id":1,"userId":104,"user_id":104,"username":"user_ewa8xu9h","walletAddress":"0xAbEf6032B9176C186F6BF984f548bdA53349f70a","wallet_address":"0xAbEf6032B9176C186F6BF984f548bdA53349f70a","purchaseAmount":8.4,"purchase_amount":8.4,"purchaseDate":"2025-08-10","purchase_date":"2025-08-10","receiptCategory":"re-use item","receipt_category":"re-use item","containsPreOwned":false,"contains_pre_owned":false,"preOwnedKeywordsFound":"","pre_owned_keywords_found":"","sustainabilityTags":"re-use item","sustainability_tags":"re-use item","paymentMethod":{},"payment_method":{},"paymentIsDigital":false,"payment_is_digital":false,"paymentCardLastFour":null,"payment_card_last_four":null,"isVechainVisa":false,"is_vechain_visa":false,"baseReward":8,"base_reward":8,"streakMultiplier":1,"streak_multiplier":1,"digitalPaymentBonus":0,"digital_payment_bonus":0,"vechainVisaBonus":0,"vechain_visa_bonus":0,"finalReward":8,"final_reward":8,"tokenReward":8,"confidenceScore":0,"confidence_score":0,"validationReasons":"","validation_reasons":"","isAcceptable":true,"is_acceptable":true,"userStreak":1,"user_streak":1,"tokenBalance":0,"token_balance":0,"timestamp":"2025-08-10T06:11:18.211Z","eventType":"submission","event_type":"submission","isTestMode":true,"is_test_mode":true,"appVersion":"1.0.4","app_version":"1.0.4","debugHasReceipt":true,"_debug_has_receipt":true,"debugHasUser":true,"_debug_has_user":true,"debugHasRewards":true,"_debug_has_rewards":true,"debugWebhookAttemptTime":"2025-08-10T06:11:18.211Z","_debug_webhook_attempt_time":"2025-08-10T06:11:18.211Z"}
[WEBHOOK] Sending request to: https://script.google.com/macros/s/AKfycbzDqopOu-WNEt9vxOn9Qrm0aD4K9gOnzj7AgRw-zXLJ8BtYk5_0V8d0dDyv816J-Eb3/exec
[WEBHOOK] Response not OK: Status 404, Text: <!DOCTYPE html><html lang="en"><head><meta name="description" content="Web word processing, presentations and spreadsheets"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0"><link rel="shortcut icon" href="//docs.google.com/favicon.ico"><title>Page Not Found</title><meta name="referrer" content="origin"><link href="//fonts.googleapis.com/css?family=Product+Sans" rel="stylesheet" type="text/css" nonce="TQFMtp7T_HexTe2z3YdY3Q"><style nonce="TQFMtp7T_HexTe2z3YdY3Q">.goog-inline-block{position:relative;display:-moz-inline-box;display:inline-block}* html .goog-inline-block{display:inline}*:first-child+html .goog-inline-block{display:inline}#drive-logo{margin:18px 0;position:absolute;white-space:nowrap}.docs-drivelogo-img{background-image:url(//ssl.gstatic.com/images/branding/googlelogo/1x/googlelogo_color_116x41dp.png);-webkit-background-size:116px 41px;background-size:116px 41px;display:inline-block;height:41px;vertical-align:bottom;width:116px}.docs-drivelogo-text{color:#000;display:inline-block;opacity:.54;text-decoration:none;font-family:"Product Sans",Arial,Helvetica,sans-serif;font-size:32px;text-rendering:optimizeLegibility;position:relative;top:-6px;left:-7px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}@media (-webkit-min-device-pixel-ratio:1.5),(min-resolution:144dpi){.docs-drivelogo-img{background-image:url(//ssl.gstatic.com/images/branding/googlelogo/2x/googlelogo_color_116x41dp.png)}}sentinel{}</style><style type="text/css" nonce="TQFMtp7T_HexTe2z3YdY3Q">body {background-color: #fff; font-family: Arial,sans-serif; font-size: 13px; margin: 0; padding: 0;}a, a:link, a:visited {color: #112ABB;}</style><style type="text/css" nonce="TQFMtp7T_HexTe2z3YdY3Q">.errorMessage {font-size: 12pt; font-weight: bold; line-height: 150%;}</style></head><body><div id="outerContainer"><div id="innerContainer"><div style="position: absolute; top: -80px;"><div id="drive-logo"><a href="/"><span class="docs-drivelogo-img" title="Google logo"></span><span class="docs-drivelogo-text">&nbsp;Drive</span></a></div></div><div align="center"><p class="errorMessage" style="padding-top: 50px">Sorry, the file you have requested does not exist.</p><p>Make sure that you have the correct URL and the file exists.</p><div style="background: #F0F6FF; border: 1px solid black; margin-top: 35px; padding: 10px 125px; width: 300px;"><p><strong>Get stuff done with Google Drive</strong></p><p>Apps in Google Drive make it easy to create, store and share online documents, spreadsheets, presentations and more.</p><p>Learn more at <a href="https://drive.google.com/start/apps">drive.google.com/start/apps</a>.</p></div></div></div></div></body><style nonce="TQFMtp7T_HexTe2z3YdY3Q">html {height: 100%; overflow: auto;}body {height: 100%; overflow: auto;}#outerContainer {margin: auto; max-width: 750px;}#innerContainer {margin-bottom: 20px; margin-left: 40px; margin-right: 40px; margin-top: 80px; position: relative;}</style></html>
6:11:18 AM [webhooks] ‚ö†Ô∏è Error sending receipt data to Google Sheets: Google Sheets webhook failed with status 404: <!DOCTYPE html><html lang="en"><head><meta name="description" content="Web word processing, presentations and spreadsheets"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0"><link rel="shortcut icon" href="//docs.google.com/favicon.ico"><title>Page Not Found</title><meta name="referrer" content="origin"><link href="//fonts.googleapis.com/css?family=Product+Sans" rel="stylesheet" type="text/css" nonce="TQFMtp7T_HexTe2z3YdY3Q"><style nonce="TQFMtp7T_HexTe2z3YdY3Q">.goog-inline-block{position:relative;display:-moz-inline-box;display:inline-block}* html .goog-inline-block{display:inline}*:first-child+html .goog-inline-block{display:inline}#drive-logo{margin:18px 0;position:absolute;white-space:nowrap}.docs-drivelogo-img{background-image:url(//ssl.gstatic.com/images/branding/googlelogo/1x/googlelogo_color_116x41dp.png);-webkit-background-size:116px 41px;background-size:116px 41px;display:inline-block;height:41px;vertical-align:bottom;width:116px}.docs-drivelogo-text{color:#000;display:inline-block;opacity:.54;text-decoration:none;font-family:"Product Sans",Arial,Helvetica,sans-serif;font-size:32px;text-rendering:optimizeLegibility;position:relative;top:-6px;left:-7px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}@media (-webkit-min-device-pixel-ratio:1.5),(min-resolution:144dpi){.docs-drivelogo-img{background-image:url(//ssl.gstatic.com/images/branding/googlelogo/2x/googlelogo_color_116x41dp.png)}}sentinel{}</style><style type="text/css" nonce="TQFMtp7T_HexTe2z3YdY3Q">body {background-color: #fff; font-family: Arial,sans-serif; font-size: 13px; margin: 0; padding: 0;}a, a:link, a:visited {color: #112ABB;}</style><style type="text/css" nonce="TQFMtp7T_HexTe2z3YdY3Q">.errorMessage {font-size: 12pt; font-weight: bold; line-height: 150%;}</style></head><body><div id="outerContainer"><div id="innerContainer"><div style="position: absolute; top: -80px;"><div id="drive-logo"><a href="/"><span class="docs-drivelogo-img" title="Google logo"></span><span class="docs-drivelogo-text">&nbsp;Drive</span></a></div></div><div align="center"><p class="errorMessage" style="padding-top: 50px">Sorry, the file you have requested does not exist.</p><p>Make sure that you have the correct URL and the file exists.</p><div style="background: #F0F6FF; border: 1px solid black; margin-top: 35px; padding: 10px 125px; width: 300px;"><p><strong>Get stuff done with Google Drive</strong></p><p>Apps in Google Drive make it easy to create, store and share online documents, spreadsheets, presentations and more.</p><p>Learn more at <a href="https://drive.google.com/start/apps">drive.google.com/start/apps</a>.</p></div></div></div></div></body><style nonce="TQFMtp7T_HexTe2z3YdY3Q">html {height: 100%; overflow: auto;}body {height: 100%; overflow: auto;}#outerContainer {margin: auto; max-width: 750px;}#innerContainer {margin-bottom: 20px; margin-left: 40px; margin-right: 40px; margin-top: 80px; position: relative;}</style></html>
[WEBHOOK ERROR] Google Sheets webhook failed with status 404: <!DOCTYPE html><html lang="en"><head><meta name="description" content="Web word processing, presentations and spreadsheets"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0"><link rel="shortcut icon" href="//docs.google.com/favicon.ico"><title>Page Not Found</title><meta name="referrer" content="origin"><link href="//fonts.googleapis.com/css?family=Product+Sans" rel="stylesheet" type="text/css" nonce="TQFMtp7T_HexTe2z3YdY3Q"><style nonce="TQFMtp7T_HexTe2z3YdY3Q">.goog-inline-block{position:relative;display:-moz-inline-box;display:inline-block}* html .goog-inline-block{display:inline}*:first-child+html .goog-inline-block{display:inline}#drive-logo{margin:18px 0;position:absolute;white-space:nowrap}.docs-drivelogo-img{background-image:url(//ssl.gstatic.com/images/branding/googlelogo/1x/googlelogo_color_116x41dp.png);-webkit-background-size:116px 41px;background-size:116px 41px;display:inline-block;height:41px;vertical-align:bottom;width:116px}.docs-drivelogo-text{color:#000;display:inline-block;opacity:.54;text-decoration:none;font-family:"Product Sans",Arial,Helvetica,sans-serif;font-size:32px;text-rendering:optimizeLegibility;position:relative;top:-6px;left:-7px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}@media (-webkit-min-device-pixel-ratio:1.5),(min-resolution:144dpi){.docs-drivelogo-img{background-image:url(//ssl.gstatic.com/images/branding/googlelogo/2x/googlelogo_color_116x41dp.png)}}sentinel{}</style><style type="text/css" nonce="TQFMtp7T_HexTe2z3YdY3Q">body {background-color: #fff; font-family: Arial,sans-serif; font-size: 13px; margin: 0; padding: 0;}a, a:link, a:visited {color: #112ABB;}</style><style type="text/css" nonce="TQFMtp7T_HexTe2z3YdY3Q">.errorMessage {font-size: 12pt; font-weight: bold; line-height: 150%;}</style></head><body><div id="outerContainer"><div id="innerContainer"><div style="position: absolute; top: -80px;"><div id="drive-logo"><a href="/"><span class="docs-drivelogo-img" title="Google logo"></span><span class="docs-drivelogo-text">&nbsp;Drive</span></a></div></div><div align="center"><p class="errorMessage" style="padding-top: 50px">Sorry, the file you have requested does not exist.</p><p>Make sure that you have the correct URL and the file exists.</p><div style="background: #F0F6FF; border: 1px solid black; margin-top: 35px; padding: 10px 125px; width: 300px;"><p><strong>Get stuff done with Google Drive</strong></p><p>Apps in Google Drive make it easy to create, store and share online documents, spreadsheets, presentations and more.</p><p>Learn more at <a href="https://drive.google.com/start/apps">drive.google.com/start/apps</a>.</p></div></div></div></div></body><style nonce="TQFMtp7T_HexTe2z3YdY3Q">html {height: 100%; overflow: auto;}body {height: 100%; overflow: auto;}#outerContainer {margin: auto; max-width: 750px;}#innerContainer {margin-bottom: 20px; margin-left: 40px; margin-right: 40px; margin-top: 80px; position: relative;}</style></html>
[WEBHOOK ERROR DETAILS] {
  eventType: 'submission',
  receiptId: 3,
  storeName: 'Uber',
  errorType: 'Error',
  timestamp: '2025-08-10T06:11:18.730Z'
}
[WEBHOOK] ‚úÖ Receipt submission webhook completed in 521ms
[User API] GET /api/users/104 - currentStreak: 1, tokenBalance: 18
[User API] GET /api/users/104 - currentStreak: 1, tokenBalance: 18
