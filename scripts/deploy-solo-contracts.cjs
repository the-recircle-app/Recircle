#!/usr/bin/env node

const fs = require('fs');
const ethers = require('ethers');

const SOLO_NODE_URL = 'http://localhost:8669';
const DEPLOYER_PRIVATE_KEY = '0x4f3edf983ac636a65a842ce7c78d9aa706d3b113b37a7c0f456fca3fcfd623a6';

// Mock B3TR Token ABI
const MOCK_B3TR_ABI = [
  "constructor(string memory name, string memory symbol, uint256 totalSupply)",
  "function mint(address to, uint256 amount) public",
  "function balanceOf(address account) view returns (uint256)",
  "function transfer(address to, uint256 amount) returns (bool)",
  "function approve(address spender, uint256 amount) returns (bool)",
  "function allowance(address owner, address spender) view returns (uint256)",
  "event Transfer(address indexed from, address indexed to, uint256 value)"
];

// FULL BYTECODE YOU PROVIDED
const MOCK_B3TR_BYTECODE = "0x608060405234801561001057600080fd5b506040516109c23803806109c28339818101604052810190610032919061028e565b82600390816100419190610540565b5080600490816100519190610540565b50806000819055508060016000610066610069565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055505050506106d4565b600033905090565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6100d78261008e565b810181811067ffffffffffffffff821117156100f6576100f561009f565b5b80604052505050565b600061010961007a565b905061011582826100ce565b919050565b600067ffffffffffffffff8211156101355761013461009f565b5b61013e8261008e565b9050602081019050919050565b60008190508160005260206000209050919050565b600061017361016e8461011a565b6100ff565b90508281526020810184848401111561018f5761018e610089565b5b61019a84828561014b565b509392505050565b600082601f8301126101b7576101b6610084565b5b81516101c7848260208601610160565b91505092915050565b6000819050919050565b6101e3816101d0565b81146101ee57600080fd5b50565b600081519050610200816101da565b92915050565b60008060006060848603121561021f5761021e61007a565b5b600084015167ffffffffffffffff81111561023d5761023c61007f565b5b610249868287016101a2565b935050602084015167ffffffffffffffff81111561026a5761026961007f565b5b610276868287016101a2565b9250506040610287868287016101f1565b9150509250925092565b6000602082840312156102a7576102a661007a565b5b600082015167ffffffffffffffff8111156102c5576102c461007f565b5b6102d1848285016101a2565b91505092915050565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061032a57607f821691505b60208210810361033d5761033c6102e3565b5b50919050565b60008190508160005260206000209050919050565b600081546103658161312565b61036f8186610312565b94506001821660008114610390576001811461039f576103d2565b60ff198316865281151582028601935b6103d2565b6103a885610343565b60005b838110156103ca578154818901526001820191506020810190506103ab565b838801955050505b50505092915050565b60006040820190508181036000830152610403815160001960006000838261035a565b90508181036020830152610424815160011960006000838261035a565b9150508181036040830152610446815160021960006000838261035a565b9150819050949350505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061048e826101d0565b9150610499836101d0565b92508282019050808211156104b1576104b0610453565b5b92915050565b60006104c2826101d0565b91506104cd836101d0565b92508282039050818111156104e5576104e4610453565b5b92915050565b600081519050919050565b600082825260208201905092915050565b600061051282610483565b61051c8185610482565b935061052c818560208601610493565b610535816104a1565b840191505092915050565b600060208201905081810360008301526105398184610507565b905092915050565b6000610548826101d0565b9150610553836101d0565b925082820190508082111561056b5761056a610453565b5b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b60006105ac826101d0565b91506105b7836101d0565b9250826105c7576105c6610571565b5b828204905092915050565b60006105dd826101d0565b91506105e8836101d0565b9250826105f8576105f7610571565b5b828206905092915050565b7f45524332303a20696e73756666696369656e7420616c6c6f77616e6365000000600082015250565b6000610639601d836104f6565b915061064482610603565b602082019050919050565b600060208201905081810360008301526106688161062c565b9050919050565b7f45524332303a207472616e7366657220616d6f756e742065786365656473206260008201527f616c616e63650000000000000000000000000000000000000000000000000000602082015250565b60006106cb6026836104f6565b91506106d68261066f565b604082019050919050565b600060208201905081810360008301526106fa816106be565b9050919050565b7f45524332303a207472616e7366657220746f20746865207a65726f206164647260008201527f6573730000000000000000000000000000000000000000000000000000000000602082015250565b600061075d6023836104f6565b915061076882610701565b604082019050919050565b6000602082019050818103600083015261078c81610750565b9050919050565b7f45524332303a20617070726f766520746f20746865207a65726f20616464726560008201527f7373000000000000000000000000000000000000000000000000000000000000602082015250565b60006107ef6022836104f6565b91506107fa82610793565b604082019050919050565b6000602082019050818103600083015261081e816107e2565b9050919050565b6000610830826101d0565b915061083b836101d0565b92508282026108498161086f565b915082820484148315176108605761085f610453565b5b5092915050565b60008160001c9050919050565b6000819050919050565b60008160e01c9050919050565b6000610895610867565b905090565b6000819050919050565b60006108af8261089a565b9150819050919050565b7f45524332303a207472616e736665722066726f6d20746865207a65726f20616460008201527f6472657373000000000000000000000000000000000000000000000000000000602082015250565b600061090e6025836104f6565b9150610919826108b9565b604082019050919050565b6000602082019050818103600083015261093d81610901565b9050919050565b7f45524332303a20617070726f76652066726f6d20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b60006109a06024836104f6565b91506109ab82610944565b604082019050919050565b600060208201905081810360008301526109cf81610993565b9050919050565b6102d6806109e56000396000f3fe608060405234801561001057600080fd5b50600436106100885760003560e01c806370a082311161005b57806370a08231146101145780638129fc1c1461014457806395d89b411461015e578063a9059cbb1461017c57610088565b806306fdde031461008d578063095ea7b3146100ab57806318160ddd146100db57806323b872dd146100f9575b600080fd5b6100956101ac565b6040516100a29190610202565b60405180910390f35b6100c560048036038101906100c09190610224565b61023e565b6040516100d2919061027f565b60405180910390f35b6100e3610261565b6040516100f091906102a9565b60405180910390f35b610113600480360381019061010e91906102c4565b610267565b005b61012e60048036038101906101299190610317565b610296565b60405161013b91906102a9565b60405180910390f35b61014c6102de565b005b6101666102e8565b6040516101739190610202565b60405180910390f35b61019660048036038101906101919190610224565b61037a565b6040516101a3919061027f565b60405180910390f35b6060600380546101bb90610373565b80601f01602080910402602001604051908101604052809291908181526020018280546101e790610373565b80156102345780601f1061020957610100808354040283529160200191610234565b820191906000526020600020905b81548152906001019060200180831161021757829003601f168201915b5050505050905090565b60008061024961039d565b90506102568185856103a5565b600191505092915050565b60005481565b6000806102723361036e565b9050610280848285856103a5565b610289846103a5565b61029161036e565b505050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b600080fd5b565b6060600480546102f790610373565b80601f016020809104026020016040519081016040528092919081815260200182805461032390610373565b80156103705780601f1061034557610100808354040283529160200191610370565b820191906000526020600020905b81548152906001019060200180831161035357829003601f168201915b5050505050905090565b600080610386336103a5565b905061039333858561056e565b6001915050929150565b600033905090565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16036104145760405162461bcd60e51b815260040161040b90610416565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036104835760405162461bcd60e51b815260040161047a90610488565b60405180910390fd5b80600260008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9258360405161056191906102a9565b60405180910390a3505050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16036105dd5760405162461bcd60e51b815260040161050490610416565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff160361064c5760405162461bcd60e51b815260040161064390610488565b60405180910390fd5b6106578383836106e9565b60008060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050818110156106dd5760405162461bcd60e51b815260040161060d90610416565b60405180910390fd5b81810360008086735ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825461077191906107a0565b925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040516107d591906102a9565b60405180910390a36107e88484846106e9565b50505050565b600082825260208201905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b600061083a826107ee565b6108448185610807565b935061085481856020860161087f565b61085d816108af565b840191505092915050565b600060208201905081810360008301526108828161082f565b9050919050565b600081519050919050565b60005b8381101561089d5780820151818401526020810190506108a2565b838111156108ac576000848401525b50505050565b6000601f19601f8301169050919050565b600081519050919050565b600082825260208201905092915050565b60006108ea826108c0565b6108f481856108cb565b93506109048185602086016108dc565b61090d816108af565b840191505092915050565b600060208201905081810360008301526109328184610889565b905092915050565b6000604051905090565b600080fd5b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061097a8261094f565b9050919050565b61098a8161096f565b811461099557600080fd5b50565b6000813590506109a781610981565b92915050565b6000819050919050565b6109c0816109ad565b81146109cb57600080fd5b50565b6000813590506109dd816109b7565b92915050565b600080604083850312156109fa576109f9610945565b5b6000610a0885828601610998565b9250506020610a19858286016109ce565b9150509250929050565b60008115159050919050565b610a3881610a23565b82525050565b6000602082019050610a536000830184610a2f565b92915050565b610a62816109ad565b82525050565b6000602082019050610a7d6000830184610a59565b92915050565b600080600060608486031215610a9c57610a9b610945565b5b6000610aaa86828701610998565b9350506020610abb86828701610998565b9250506040610acc868287016109ce565b9150509250925092565b600060208284031215610aec57610aeb610945565b5b6000610afa84828501610998565b91505092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610b4b57607f821691505b602082108103610b5e57610b5d610b03565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000610b9e816109ad565b9150610ba9836109ad565b9250828201905080821115610bc157610bc0610b64565b5b92915050565b7f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f7760008201527f207a65726f000000000000000000000000000000000000000000000000000000602082015250565b6000610c236025836108cb565b9150610c2e82610bc7565b604082019050919050565b60006020820190508181036000830152610c5281610c16565b9050919050565b7f45524332303a20617070726f76652066726f6d20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b6000610cb56024836108cb565b9150610cc082610c59565b604082019050919050565b60006020820190508181036000830152610ce481610ca8565b9050919050565b7f45524332303a20617070726f766520746f20746865207a65726f20616464726560008201527f7373000000000000000000000000000000000000000000000000000000000000602082015250565b6000610d476022836108cb565b9150610d5282610ceb565b604082019050919050565b60006020820190508181036000830152610d7681610d3a565b9050919050565b7f45524332303a20696e73756666696369656e7420616c6c6f77616e6365000000600082015250565b6000610db3601d836108cb565b9150610dbe82610d7d565b602082019050919050565b60006020820190508181036000830152610de281610da6565b9050919050565b7f45524332303a207472616e736665722066726f6d20746865207a65726f20616460008201527f6472657373000000000000000000000000000000000000000000000000000000602082015250565b6000610e456025836108cb565b9150610e5082610de9565b604082019050919050565b60006020820190508181036000830152610e7481610e38565b9050919050565b7f45524332303a207472616e7366657220746f20746865207a65726f206164647260008201527f6573730000000000000000000000000000000000000000000000000000000000602082015250565b6000610ed76023836108cb565b9150610ee282610e7b565b604082019050919050565b60006020820190508181036000830152610f0681610eca565b9050919050565b7f45524332303a207472616e7366657220616d6f756e742065786365656473206260008201527f616c616e63650000000000000000000000000000000000000000000000000000602082015250565b6000610f696026836108cb565b9150610f7482610f0d565b604082019050919050565b60006020820190508181036000830152610f9881610f5c565b9050919050565b600060e082019050610fb4600083018a610a59565b610fc16020830189610a59565b610fce6040830188610a59565b610fdb6060830187610a59565b610fe86080830186610a59565b610ff560a0830185610a59565b61100260c0830184610a59565b98975050505050505050565b600060c0820190506110236000830189610a59565b6110306020830188610a59565b61103d6040830187610a59565b61104a6060830186610a59565b6110576080830185610a59565b61106460a0830184610a59565b979650505050505050565b600060a08201905061108460008301888102130184610a59565b611091602083018761012601310185610a59565b61109e60408301866126013103610a59565b6110ab60608301851260130185610a59565b6110b860808301846126013103610a59565b9695505050505050565b600060808201905086138201138860008301121301848601611a8410140185610a59565b601326013115301121301848601148414013103610a59565b606021851301121301121901135086601446013103610a59565b608085850121301123301126013133101234010f8601136010610a59565b9450505050565b600060608201905081103830168101348601138601138103610a59565b60208301681030186013601368103610a59565b604083016105320163013330334013610a59565b9250505092915050565b600060408201905061116660008301851f69151460151301138601138103610a59565b61117360208301841f691c1330186013036013610a59565b9392505050565b600060208201905061118f6000830184610a59565b92915050565b6000819050919050565b60006111aa82611195565b91506111b583611195565b9250828201905080821115611c1cd57611bcc611b64565b5b92915050565b7f45524332303a206d696e7420746f20746865207a65726f2061646472657373600082015250565b60006111ff6020836108cb565b915061120a826111c9565b602082019050919050565b6000602082019050818103600083015261122e816111f2565b9050919050565b600061124082611195565b915061124b83611195565b925082820390508181111561126357611262611b64565b5b92915050565b7f45524332303a206275726e2066726f6d20746865207a65726f20616464726573600082015250565b600061129f601f836108cb565b91506112aa82611269565b602082019050919050565b600060208201905081810360008301526112ce81611292565b9050919050565b7f45524332303a206275726e20616d6f756e7420657863656564732062616c616e60008201527f6365000000000000000000000000000000000000000000000000000000000000602082015250565b60006113316022836108cb565b915061133c826112d5565b604082019050919050565b6000602082019050818103600083015261136081611324565b905091905056fea2646970667358221220f5d7c3e7a4b7e75d6f3e0c2b1a98765432109876543210987654321098765432164736f6c63430008120033";

// === Deployment Logic ===
async function deploy() {
  console.log("🚀 Deploying contracts to VeChain solo node...");

  const provider = new ethers.JsonRpcProvider(SOLO_NODE_URL);
  const wallet = new ethers.Wallet(DEPLOYER_PRIVATE_KEY, provider);

  const balance = await provider.getBalance(wallet.address);
  console.log("💰 Deployer address:", wallet.address);
  console.log("🪙 Balance:", ethers.formatEther(balance), "VET");

  console.log("\n📦 Deploying Mock B3TR Token...");
  const tokenFactory = new ethers.ContractFactory(MOCK_B3TR_ABI, MOCK_B3TR_BYTECODE, wallet);
  const mockB3TR = await tokenFactory.deploy("Better Token", "B3TR", ethers.parseEther("10000000"));
  await mockB3TR.waitForDeployment();

  const deployedAddress = await mockB3TR.getAddress();
  console.log("✅ B3TR deployed at:", deployedAddress);

  fs.writeFileSync("solo-b3tr-address.json", JSON.stringify({ B3TR: deployedAddress }, null, 2));
  console.log("📄 Saved address to solo-b3tr-address.json");

  console.log("\n🪙 Add Custom Token to VeWorld Wallet:");
  console.log("  Token Address:", deployedAddress);
  console.log("  Symbol: B3TR");
  console.log("  Decimals: 18");
}

deploy().catch((err) => {
  console.error("❌ Deployment failed:", err.message);
});